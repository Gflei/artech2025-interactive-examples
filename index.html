<!DOCTYPE html>
<html lang='en'>
<head>
  <meta charset='UTF-8'>
  <title>Decompose/Recompose the Soundscape
    Aesthetic experimentation using spectral manipulation techniques in immersive soundscape composition
    </title>
  <link rel="stylesheet" href="styles.css">
</head>
<body>
  <h1>Sound Examples from Article</h1>
  <p>Interactive Sound Examples from the Article "Decompose/Recompose the Soundscape". Click on spectrogram to play, use pause button to stop.</p>

  <div id='players'></div>

  <script type='module'>
    import WaveSurfer from 'https://unpkg.com/wavesurfer.js@beta/dist/wavesurfer.js';
    import SpectrogramPlugin from 'https://unpkg.com/wavesurfer.js@beta/dist/plugins/spectrogram.js';

    const audioGroups = [
      {
        title: 'Monte Ahava Soundscape (Alentejo)',
        files: [
          ['Original Recording', 'audio/MonteAhava2.ogg'],
          ['Manipulated 1', 'audio/1_SpectraeqTest12_MonteAhava2Fix.ogg'],
          ['Manipulated 2', 'audio/16_SpectraeqTest9_MonteAhavaSoundscape2.ogg'],
          ['Manipulated 3', 'audio/4_monteahava2_Autoconvolutionx1.ogg']
          
        ]
      },
      {
        title: 'Soundwalk Field Recording (Spanish Stairs to Via Del Corso, Rome)',
        files: [
          ['Original Recording', 'audio/EditingRomeAmbience_Phonography_SpanishStairs2ViaDelCorso.ogg'],
          ['Manipulated Composition', 'audio/2_SpectraeqTest21_RomeViaDelCorsonicely.ogg']
        ]
      },
      {
        title: 'Vila Real Soundscape (Portugal)',
        files: [
          ['Original Recording', 'audio/vilaRealAmbience1Binaural.ogg'],
          ['Manipulated Composition', 'audio/10_SpectraeqTest11_VilaRealFix.ogg'],
          ['Manipulated 2', 'audio/11_SpectraeqTest13_VilaRealFixerLow.ogg']
        ]
      },
      {
        title: 'STOP Centro Comercial Demonstration Field Recording (Porto, Portugal)',
        files: [
          ['Original Recording', 'audio/StopDemostrationEdit.ogg'],
          ['Manipulated 1', 'audio/13_SpectraeqTest23_STOP.ogg'],
          ['Manipulated 2', 'audio/14_SpectraeqTest3_STOP Demonstration Drummers.ogg']
        ]
      }
    ];

    const allPlayers = [];

    audioGroups.forEach((group, groupIndex) => {
      const groupDiv = document.createElement('div');
      groupDiv.className = 'group';

      const groupTitle = document.createElement('h2');
      groupTitle.textContent = group.title;
      groupDiv.appendChild(groupTitle);

      group.files.forEach(([label, url], fileIndex) => {
        const container = document.createElement('div');
        container.className = 'player';

        const title = document.createElement('h3');
        title.textContent = label;
        container.appendChild(title);


        // Visible waveform container
        const waveformDiv = document.createElement('div');
        waveformDiv.id = `waveform-${groupIndex}-${fileIndex}`;
        waveformDiv.style.cssText = `margin:8px 0;`;
        container.appendChild(waveformDiv);

        // Visible spectrogram container (equal height to waveform)
        const spectrogramDiv = document.createElement('div');
        spectrogramDiv.id = `spectrogram-${groupIndex}-${fileIndex}`;
        spectrogramDiv.style.cssText = `margin:8px 0;`;
        container.appendChild(spectrogramDiv);

        // Create progress scroller
        // No overlay elements to keep rendering simple and fast

        const playBtn = document.createElement('button');
        playBtn.textContent = 'Play';
        playBtn.id = `playBtn-${groupIndex}-${fileIndex}`;
        playBtn.style.cssText = 'margin:6px 10px 0 0;padding:8px 14px;font-size:14px;border-radius:6px;border:1px solid #ccc;background:#3498db;color:#fff;cursor:pointer;';
        container.appendChild(playBtn);

        const pauseBtn = document.createElement('button');
        pauseBtn.textContent = 'Pause';
        pauseBtn.id = `pauseBtn-${groupIndex}-${fileIndex}`;
        pauseBtn.disabled = true;
        pauseBtn.style.cssText = 'margin:6px 0 0 0;padding:8px 14px;font-size:14px;border-radius:6px;border:1px solid #ccc;background:#3498db;color:#fff;cursor:pointer;';
        container.appendChild(pauseBtn);

        groupDiv.appendChild(container);

        document.getElementById('players').appendChild(groupDiv);

        // Create WaveSurfer instance with optimized settings
        const wavesurfer = WaveSurfer.create({
          container: '#' + waveformDiv.id,
          waveColor: '#000000',
          progressColor: '#555555',
          url: url,
          height: 256,
          hideScrollbar: true,
          normalize: false,
          plugins: [
            SpectrogramPlugin.create({
              container: '#' + spectrogramDiv.id,
              labels: true,
              height: 256,
              fftSamples: 2048,
              useWebWorker: true,
              frequencyMax: 20000,
              frequencyMin: 35,
              splitChannels: false,
              windowFunc: 'hann',
              maxCanvasWidth: 4000
            })
          ]
        });

        // Use default colormap for simplicity and speed

        allPlayers.push(wavesurfer);

        // Click on spectrogram to play (optimized interaction)
        wavesurfer.on('interaction', () => {
          // Pause all other players
          allPlayers.forEach(p => {
            if (p !== wavesurfer) p.pause();
          });
          wavesurfer.play();
          updateButtonStates(wavesurfer, playBtn, pauseBtn);
        });

        // Add click event listener to spectrogram container for click-to-play and seek
        spectrogramDiv.addEventListener('click', (e) => {
          // Calculate click position for seeking
          const rect = spectrogramDiv.getBoundingClientRect();
          const clickX = e.clientX - rect.left;
          const spectrogramWidth = spectrogramDiv.offsetWidth;
          const clickProgress = clickX / spectrogramWidth;
          
          // Seek to clicked position
          const duration = wavesurfer.getDuration();
          if (duration) {
            wavesurfer.seekTo(clickProgress);
          }
          
          // Pause all other players
          allPlayers.forEach(p => {
            if (p !== wavesurfer) p.pause();
          });
          wavesurfer.play();
          updateButtonStates(wavesurfer, playBtn, pauseBtn);
        });

        // Play button functionality
        playBtn.onclick = () => {
          // Pause all other players
          allPlayers.forEach(p => {
            if (p !== wavesurfer) p.pause();
          });
          wavesurfer.play();
          updateButtonStates(wavesurfer, playBtn, pauseBtn);
        };

        // Pause button functionality
        pauseBtn.onclick = () => {
          wavesurfer.pause();
          updateButtonStates(wavesurfer, playBtn, pauseBtn);
        };

        // Update button states based on player state
        function updateButtonStates(player, playBtn, pauseBtn) {
          if (player.isPlaying()) {
            playBtn.disabled = true;
            pauseBtn.disabled = false;
          } else {
            playBtn.disabled = false;
            pauseBtn.disabled = true;
          }
        }

        // Listen for state changes to update buttons
        wavesurfer.on('play', () => updateButtonStates(wavesurfer, playBtn, pauseBtn));
        wavesurfer.on('pause', () => updateButtonStates(wavesurfer, playBtn, pauseBtn));
        wavesurfer.on('finish', () => updateButtonStates(wavesurfer, playBtn, pauseBtn));

        // Simple example: no custom progress overlay
      });
    });
  </script>

  <!-- Bandcamp Album Embed -->
  <div style="margin-top: 40px; text-align: center; padding: 20px; background: #f8f9fa; border-radius: 8px;">
    <h2 style="color: #2c3e50; margin-bottom: 20px;">Full Album Available on Bandcamp</h2>
    <iframe style="border: 0; width: 350px; height: 470px;" src="https://bandcamp.com/EmbeddedPlayer/album=144355698/size=large/bgcol=ffffff/linkcol=0687f5/tracklist=false/transparent=true/" seamless><a href="https://guyfleisher.bandcamp.com/album/decompose-recompose-the-soundscape">Decompose/Recompose the Soundscape by Guy Fleisher</a></iframe>
  </div>
</body>
</html>
